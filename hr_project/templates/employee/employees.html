{% extends 'base.html' %}
{% load humanize %}
{% block title %}Employees · Mega Coffee HR{% endblock %}
{% block nav_employees_active %}active{% endblock %}

{% block content %}
  <div class="page-header">
    <h1>근무자 정보</h1>
    <div class="actions">
      <a href="{% url 'employees:create' %}" class="btn primary" >직원 추가</a>
    </div>
  </div>
<div class="card">
  <h2>employees</h2>
  <table class="table">
    <thead>
      <tr>
        <th>이름</th>
        <th>근무 유형</th>
        <th>근무 요일</th>
        <th>근무 시간</th>
        <th>시급</th>
        <th>관리</th>
      </tr>
    </thead>
    <tbody>
      {% for emp in employees %}
      <tr>
        <!--이름-->
        <td>
          <div class="user">
            <span> {{ emp.full_name }} </span>
            <span class="dot" style="background-color: {{ emp.color_tag }};"></span>
          </div>
        </td>
        <!--근무 유형-->
        <td>
          {% with emp.schedules.first as first_schedule %}
            {{ first_schedule.get_work_type_display }}
          {% endwith %}
        </td>
        <!--근무 요일-->
        <td>
          {% for s in emp.schedules.all %}
            {{ s.get_work_day_display }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            -
          {% endfor %}
        </td>
        <!--근무 시간-->
        <td>
          {% with emp.schedules.first as first_schedule %}
            {{ first_schedule.get_work_time_display }}
          {% endwith %}
        </td>
        <!--시급-->
        <td>
          {% with emp.wages.all|dictsortreversed:"effective_start_date"|first as current_wage %}
            {% if current_wage %}
              ₩ {{ current_wage.hourly_wage|floatformat:0|intcomma }}
            {% else %}
              -
            {% endif %}
          {% endwith %}
        </td>
        <td>
          <div style="display: flex; gap: 8px;">
            <a href="{% url 'employees:edit' emp.pk %}" class="btn" style="padding: 4px 12px; font-size: 14px;">수정</a>
            <form method="post" action="{% url 'employees:delete' emp.pk %}" style="display: inline;" onsubmit="return confirm('{{ emp.full_name }} 직원을 삭제하시겠습니까?');">
              {% csrf_token %}
              <button type="submit" class="btn" style="padding: 4px 12px; font-size: 14px; background: #ef4444; color: white;">삭제</button>
            </form>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" style="text-align: center; padding: 2rem; color: #888;">
          등록된 직원이 없습니다. "직원 추가" 버튼을 눌러 직원을 추가하세요.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}