{% extends 'base.html' %}
{% block title %}Attendance · Mega Coffee HR{% endblock %}
{% block nav_attendance_active %}active{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Employee Attendance</h1>
  <div class="actions">
    <input type="date" value="{{ filter_date }}" onchange="window.location.href='?date='+this.value" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
    <a href="{% url 'attendances:checkin' %}" class="btn primary" target="_blank">출근 체크인</a>
  </div>
</div>

<div class="card">
  <h2>Daily Attendance ({{ filter_date }})</h2>
  <table class="table">
    <thead>
      <tr>
        <th style="width: 15%;">Employee Name</th>
        <th style="width: 25%;">Shift</th>
        <th style="width: 20%;">Age</th>
        <th style="width: 20%;">Check In</th>
        <th style="width: 20%;">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for record in attendance_records %}
      <tr>
        <td>
          <div class="user">
            {% if record.employee.image %}
            <div class="avatar sm" style="background-image: url('{{ record.employee.image.url }}'); background-size: cover;"></div>
            {% else %}
            <div class="avatar sm"></div>
            {% endif %}
            <span>{{ record.employee.full_name }}</span>
            <span class="dot" style="background-color: {{ record.employee.color_tag }};"></span>
          </div>
        </td>
        <td>
          {% if '오픈' in record.employee.shift.name %}오픈{% elif '마감' in record.employee.shift.name %}마감{% elif '미들' in record.employee.shift.name %}미들{% endif %} | 
          {% if '월화수' in record.employee.shift.name %}월화수{% elif '목금' in record.employee.shift.name %}목금{% elif '토일' in record.employee.shift.name %}토일{% endif %} | 
          {{ record.employee.shift.time_range }}
        </td>
        <td>{{ record.employee.birth_year }}년생</td>
        <td>
          {% if record.check_in %}
            <span class="chip blue">{{ record.check_in|date:"H:i" }}</span>
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if record.status == 'working' %}
            <span class="badge green">근무중</span>
          {% elif record.status == 'finished' %}
            <span class="badge orange">퇴근</span>
          {% elif record.status == 'sick_leave' %}
            <span class="badge purple">병가</span>
          {% elif record.status == 'vacation' %}
            <span class="badge blue">휴가</span>
          {% elif record.status == 'not_checked_in' %}
            <span class="badge gray">미출근</span>
          {% elif record.status == 'absent' %}
            <span class="badge red">결근</span>
          {% else %}
            <span class="badge gray">미출근</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" style="text-align: center; padding: 2rem; color: #888;">
          출석 기록이 없습니다.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
